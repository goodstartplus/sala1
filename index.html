<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Entrar na Reuni√£o</title>

  <!-- Zoom SDK Styles -->
  <link rel="stylesheet" href="https://source.zoom.us/3.11.0/css/bootstrap.css" />
  <link rel="stylesheet" href="https://source.zoom.us/3.11.0/css/react-select.css" />

  <style>
    #zmmtg-root {
      height: 100vh;
      width: 100%;
      position: relative;
      z-index: 999;
      background-color: #000;
    }
    body {
      margin: 0;
      padding: 0;
      overflow: hidden;
    }
    .container {
      text-align: center;
      padding-top: 50px;
    }
  </style>
</head>

<body>

<div class="container">
  <h2>Entrar na Reuni√£o</h2>
  <input type="text" id="display_name" placeholder="Seu Nome" required>
  <button id="joinMeeting">Entrar na Reuni√£o</button>
</div>

<div id="zmmtg-root"></div>

<!-- Zoom SDK Scripts -->
<script src="https://source.zoom.us/3.11.0/lib/vendor/react.min.js"></script>
<script src="https://source.zoom.us/3.11.0/lib/vendor/react-dom.min.js"></script>
<script src="https://source.zoom.us/3.11.0/lib/vendor/redux.min.js"></script>
<script src="https://source.zoom.us/3.11.0/lib/vendor/redux-thunk.min.js"></script>
<script src="https://source.zoom.us/3.11.0/zoom-meeting-3.11.0.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jsrsasign/10.5.18/jsrsasign-all-min.js"></script>

<script>
  // ‚ö†Ô∏è TESTING ONLY - Zoom Credentials
  const apiKey = 'USroBek9TFK0sdTnKGQcg';
  const apiSecret = 'xfjGAB6qOuMVQCABv8obRavSaNrd1X8d';
  const meetingNumber = '87370145813';
  const passWord = '0fGYcM';

  // ‚öôÔ∏è Initialize SDK
  document.addEventListener('DOMContentLoaded', function () {
    ZoomMtg.setZoomJSLib('https://source.zoom.us/3.11.0/lib', '/av');
    ZoomMtg.preLoadWasm();
    ZoomMtg.prepareJssdk();
  });

  // üîë Generate Signature (CLIENT-SIDE for TESTING ONLY)
  function generateSignature(apiKey, apiSecret, meetingNumber, role) {
    const iat = Math.round(new Date().getTime() / 1000) - 30;
    const exp = iat + 60 * 60 * 2;

    const oHeader = { alg: 'HS256', typ: 'JWT' };
    const oPayload = {
      sdkKey: apiKey,
      mn: meetingNumber,
      role: role,
      iat: iat,
      exp: exp,
      appKey: apiKey,
      tokenExp: exp
    };

    const sHeader = JSON.stringify(oHeader);
    const sPayload = JSON.stringify(oPayload);
    return KJUR.jws.JWS.sign('HS256', sHeader, sPayload, apiSecret);
  }

  // üö™ Start Meeting
  function startMeeting(signature, userName) {
    ZoomMtg.init({
      leaveUrl: 'https://goodstart.com.br',
      success: function () {
        ZoomMtg.join({
          signature: signature,
          meetingNumber: meetingNumber,
          userName: userName,
          apiKey: apiKey,
          passWord: passWord,
          success: function () {
            console.log('‚úÖ Reuni√£o iniciada com sucesso!');
          },
          error: function (err) {
            console.error('‚ùå Erro ao iniciar a reuni√£o:', err);
          }
        });
      },
      error: function (err) {
        console.error('‚ùå Erro ao inicializar o SDK:', err);
      }
    });
  }

  // üñ±Ô∏è Button Event
  document.getElementById('joinMeeting').addEventListener('click', function () {
    const userName = document.getElementById('display_name').value.trim();
    if (!userName) {
      alert('Por favor, digite seu nome.');
      return;
    }

    const signature = generateSignature(apiKey, apiSecret, meetingNumber, 0);  // 0 = Participant
    startMeeting(signature, userName);
  });
</script>

</body>
</html>
