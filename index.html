<!-- Estilo necess√°rio para o Zoom SDK -->
<link type="text/css" rel="stylesheet" href="https://source.zoom.us/3.11.0/css/bootstrap.css" />
<link type="text/css" rel="stylesheet" href="https://source.zoom.us/3.11.0/css/react-select.css" />

<style>
  #zmmtg-root {
    height: 100vh;
    width: 100%;
    position: relative;
    z-index: 999;
    background-color: #000;
  }
  body {
    margin: 0;
    padding: 0;
    overflow: hidden;
  }
</style>

<!-- Bot√£o para entrar na reuni√£o -->
<button id="joinMeeting">Entrar na Reuni√£o</button>
<div id="zmmtg-root"></div>

<!-- Scripts do Zoom SDK (VERS√ÉO 3.11.0) -->
<script src="https://source.zoom.us/3.11.0/lib/vendor/react.min.js"></script>
<script src="https://source.zoom.us/3.11.0/lib/vendor/react-dom.min.js"></script>
<script src="https://source.zoom.us/3.11.0/lib/vendor/redux.min.js"></script>
<script src="https://source.zoom.us/3.11.0/lib/vendor/redux-thunk.min.js"></script>

<!-- SDK do Zoom -->
<script src="https://source.zoom.us/3.11.0/zoom-meeting-3.11.0.min.js"></script>

<!-- Biblioteca para gerar a assinatura -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jsrsasign/10.5.18/jsrsasign-all-min.js"></script>

<script>
  // üîê Credenciais do Zoom
  const apiKey = 'USroBek9TFK0sdTnKGQcg';
  const apiSecret = 'xfjGAB6qOuMVQCABv8obRavSaNrd1X8d';
  const meetingNumber = '87370145813';
  const passWord = '0fGYcM';

  // üìß Dados de TESTE do aluno
  const userName = 'Aluno Teste';
  const userEmail = 'aluno.teste@goodstart.com.br';

  // ‚öôÔ∏è Inicializar o SDK com caminho correto
  document.addEventListener('DOMContentLoaded', function () {
    if (typeof ZoomMtg !== 'undefined') {
      ZoomMtg.setZoomJSLib('https://source.zoom.us/3.11.0/lib', '/av');
      ZoomMtg.preLoadWasm();
      ZoomMtg.prepareJssdk();
    } else {
      console.error('‚ùå ZoomMtg n√£o carregou corretamente!');
    }
  });

  // üîë Fun√ß√£o para gerar a assinatura
  function generateSignature(apiKey, apiSecret, meetingNumber, role) {
    const iat = Math.round(new Date().getTime() / 1000) - 30;
    const exp = iat + 60 * 60 * 2;

    const oHeader = { alg: 'HS256', typ: 'JWT' };
    const oPayload = {
      sdkKey: apiKey,
      mn: meetingNumber,
      role: role,
      iat: iat,
      exp: exp,
      appKey: apiKey,
      tokenExp: exp
    };

    const sHeader = JSON.stringify(oHeader);
    const sPayload = JSON.stringify(oPayload);
    const signature = KJUR.jws.JWS.sign('HS256', sHeader, sPayload, apiSecret);

    startMeeting(signature);
  }

  // üö™ Fun√ß√£o para iniciar a reuni√£o
  function startMeeting(signature) {
    ZoomMtg.init({
      leaveUrl: 'https://goodstart.com.br',
      isSupportAV: true,
      success: function () {
        ZoomMtg.join({
          signature: signature,
          meetingNumber: meetingNumber,
          userName: userName,    // Nome fixo de TESTE
          apiKey: apiKey,
          userEmail: userEmail,  // Email fixo de TESTE
          passWord: passWord,
          success: function () {
            console.log('‚úÖ Reuni√£o iniciada com sucesso!');
          },
          error: function (err) {
            console.error('‚ùå Erro ao iniciar a reuni√£o:', err);
          }
        });
      },
      error: function (err) {
        console.error('‚ùå Erro ao inicializar o SDK:', err);
      }
    });
  }

  // üñ±Ô∏è Evento do bot√£o
  document.getElementById('joinMeeting').addEventListener('click', function () {
    generateSignature(apiKey, apiSecret, meetingNumber, 0);
  });
</script>
